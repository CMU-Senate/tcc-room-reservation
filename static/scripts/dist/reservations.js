'use strict';var CALENDAR_DAYS_INTO_FUTURE=10,MAXIMUM_DURATION_HOURS=3,RESERVATION_TOAST_DURATION_SECONDS=3e3;$(document).ready(function(){$('#cancel-reservation-modal').modal(),$('#cancel-reservation').click(function(a){var b=$(a.target).data('reservation');$.post({url:'reservation/'+b.id+'/cancel',success:function success(c){c.success?Materialize.toast('Success! Your reservation was cancelled.',RESERVATION_TOAST_DURATION_SECONDS):Materialize.toast('Failed to cancel your reservation: '+c.error+'.',RESERVATION_TOAST_DURATION_SECONDS),app.csrfToken=c.csrf_token},error:function error(){Materialize.toast('Failed to cancel your reservation.',RESERVATION_TOAST_DURATION_SECONDS)},complete:function complete(){$('.calendar[data-room-id="'+b.room+'"]').fullCalendar('refetchEvents')}})}),$('.calendar').each(function(a,b){var c=$(b).data('room-id');$(b).fullCalendar({defaultView:'agendaWeek',allDaySlot:!1,selectable:!0,eventOverlap:!1,selectOverlap:!1,header:{left:'today',center:'',right:'prev, next'},events:function events(d,e,f,g){$.get({url:'/reservations/'+c,data:{start:d.clone().startOf('week').unix(),end:e.unix()},success:function success(h){g(h.map(function(i){return i.user===app.userId&&(i.color='green'),i.cancelled&&(i.color='gray'),i}))}})},select:function select(d,e){$.post({url:'/reservation/add',data:{room:c,start:d.unix(),end:e.unix()},success:function success(f){f.success?Materialize.toast('Success! Your reservation has been made.',RESERVATION_TOAST_DURATION_SECONDS):Materialize.toast('Failed to create a reservation: '+f.error+'.',RESERVATION_TOAST_DURATION_SECONDS),app.csrfToken=f.csrf_token},error:function error(){Materialize.toast('Failed to create a reservation.',RESERVATION_TOAST_DURATION_SECONDS)},complete:function complete(){$(b).fullCalendar('refetchEvents')}})},validRange:function validRange(d){return{start:d,end:d.clone().add(CALENDAR_DAYS_INTO_FUTURE,'days')}},selectAllow:function selectAllow(d){return d.end.diff(d.start,'hours')<=MAXIMUM_DURATION_HOURS||app.admin},eventClick:function eventClick(d){(d.user===app.userId||app.admin)&&($('#cancel-reservation-modal').modal('open'),$('#cancel-reservation-modal').find('#cancel-reservation').data('reservation',d))},eventRender:function eventRender(d,e){!d.cancelled&&(d.user===app.userId||app.admin)&&$(e).append($('<i class="material-icons tiny cancel-reservation-icon">delete</i>'))}})})});
//# sourceMappingURL=reservations.js.map
